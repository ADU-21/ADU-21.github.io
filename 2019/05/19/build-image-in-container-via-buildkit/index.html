<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="杜屹东的博客"><meta name="keywords" content="云, AWS, Cloud, DevOps, 持续交付, 敏捷, Python"><title>下一代镜像构建工具 Buildkit | 杜屹东的博客</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">下一代镜像构建工具 Buildkit</h1><a id="logo" href="/.">杜屹东的博客</a><p class="description">学无止境</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">下一代镜像构建工具 Buildkit</h1><div class="post-meta"><span class="date">May 19, 2019</span><span class="category"><a href="/categories/工具/">工具</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i> Hits</i></i></span><a href="/2019/05/19/build-image-in-container-via-buildkit/#comments" class="comment-count"><i data-disqus-identifier="2019/05/19/build-image-in-container-via-buildkit/" class="disqus-comment-count"></i> 留言</a></div><div class="post-content"><p>Buildkit 是 Docker 公司出品的一款更高效、docekrfile 无关、更契合“<a href="https://www.duyidong.com/2017/05/03/Cloud-Native/">云原生应用</a>” 的新一代 Docker 构建工具。</p>
<h1 id="开源工具已经不能满足-DID-的需求"><a href="#开源工具已经不能满足-DID-的需求" class="headerlink" title="开源工具已经不能满足 DID 的需求"></a>开源工具已经不能满足 DID 的需求</h1><p>云原生的一个特点是一切基础设施都是动态的，除了提供服务的基础设施，CICD 的计算资源也趋向动态创建。很多企业已经有了自己的 k8s 集群作为服务，自然而然开始思考如何把 CICD 搬到 k8s 中，各种 CI 工具的插件应运而生，而容器集群中的构建成为了各种工具的焦点问题。</p>
<h2 id="DID-Docker-in-docker-的演进"><a href="#DID-Docker-in-docker-的演进" class="headerlink" title="DID (Docker in docker 的演进)"></a>DID (Docker in docker 的演进)</h2><p>最原始的 Docker in docker 是使用 privilege 将宿主机的一切权限共享给用于构建的容器实例，这种方式容器可以获得宿主机的最高权限，有很大风险，很快就被淘汰了。</p>
<p>目前比较普遍的做法，是把 Docker daemon 的 socket 挂在到用于构建的容器中:</p>
<pre><code class="bash">docker run -v /var/run/docker.sock:/var/run/docker.sock -it docker
</code></pre>
<p>这种方式已经经历了较长时间的验证，可以满足企业内部使用的大部分场景：</p>
<ul>
<li><strong>远程仓库权限：</strong>对于 Docker credential 的隔离可以利用不同容器实例之间 Home directory 不同做到</li>
<li><strong>缓存：</strong>同一台宿主机上的缓存可以通过同一个 Docker daemon 共享</li>
<li><strong>本地权限：</strong>由于不同容器实例挂在同一个宿主机的 Docker daemon 进程，所有实例里 docker 命令的权限也是共享的，也就是说不同容器实例可以查看甚至更新、删除到同一个 Docker daemon 下别的容器实例构建产生的镜像。</li>
</ul>
<p>本地权限的问题如果是在一个小企业内部以共享账号的方式或许还可以接受，稍微大一点的企业可以通过限制用户输入 Docker 命令，防止注入来规避权限盗用的风险。但目前看来这些方法都还是治标不治本，治本的方案要么是在 Docker daemon 建立一套权限机制，要么让 Docker 里的构建不依赖同一个 Docker daemon。</p>
<h1 id="Build-without-docker-daemon"><a href="#Build-without-docker-daemon" class="headerlink" title="Build without docker daemon"></a>Build without docker daemon</h1><p>社区中目前有三款工具可以支持无 docker daemon 化的构建： kaniko，img 和 buildkit.</p>
<ul>
<li><a href="https://github.com/GoogleContainerTools/kaniko" target="_blank" rel="noopener">Kaniko</a> 是由 Google 开发的在 k8s 上做 docker 构建的命令行工具，使用非常简洁，只需要 build 一个二进制工具即可，支持 dockerfile 构建、push、credentail 文件读取。</li>
<li><a href="https://github.com/moby/buildkit" target="_blank" rel="noopener">Buildkit</a> 是 docker 公司开发，目前由社区和 docker 公司合理维护的“含着金钥匙出生”的新一代构建工具，拥有良好的扩展性、极大地提高了构建速度，以及更好的安全性，功能上配合 docker 使用还是没问题的，独立使用功能其实有残缺，这个放到后面来讲。</li>
<li><a href="https://github.com/genuinetools/img" target="_blank" rel="noopener">img</a> 是社区贡献者开发，基于 buildkit 封装的类 docker 化命令行工具，无需 daemon 进程，无需 privilege，可以独立运行的二进制工具，非常小巧易用，而且有着和 buildkit 一样的性能优势。</li>
</ul>
<h2 id="社区活跃度"><a href="#社区活跃度" class="headerlink" title="社区活跃度"></a>社区活跃度</h2><p><strong>kaniko &gt; img &gt; buildkit</strong></p>
<p><img src="/images/kaniko-insights.png" alt=""></p>
<p><img src="/images/img-insigths.png" alt=""></p>
<p><img src="/images/buildkit-insights.png" alt=""></p>
<p>可以看出三个工具中 kaniko 是 star 最多的项目， img 目前是缺少维护的状态，buildkit start 最少但是社区活跃度还比较高。</p>
<h2 id="kaniko-踩坑"><a href="#kaniko-踩坑" class="headerlink" title="kaniko 踩坑"></a>kaniko 踩坑</h2><p>初步看来 kaniko 似乎是最佳选择，大厂背书，相对活跃的社区和相对多的市场验证。然而我们却发现了当前版本(v0.9.0)的两个不足：</p>
<ul>
<li>Dockerfile 支持不全：由于实现方式和 docker 不同，kaniko 并不是完全兼容 dockerfile 的所有语法：例如多阶段构建中 FROM … AS xxx 的语法 xxx 首字母不能大写；from 的镜像系统文件无法在 build 的时候被覆盖而是会报错</li>
<li>缓存不能共享，kaniko 的缓存只能够利用到基础镜像级别，即事先把镜像放到缓存目录下， kaniko 可以使用这个本地镜像，而构建过程中产生的镜像 layers 则不能复用。docker 多阶段构建会有相当多的 dependency 中间产物，每次构建都去下载这些依赖会极大地降低构建速度从而带来不好的体验</li>
</ul>
<p>基于以上两点，kaniko 似乎仍是一个不够成熟的工具，暂时不能投入生产。</p>
<h2 id="img-踩坑"><a href="#img-踩坑" class="headerlink" title="img 踩坑"></a>img 踩坑</h2><p>了解过 buildkit 的高性能之后，对 img 这样集简洁与性能于一身的工具可谓是满怀期待，而事实却不尽如人意，虽然 kaniko 遇到的 dockerfile  img 都轻松支持了，但是在多阶段镜像构建的时候似乎在并行构建的处理上有些问题，对于复杂的多阶段构建会频繁曝出 IO 异常，怀疑是缺少了 daemon 进程文件锁的功能导致的，只好放弃。</p>
<h1 id="Buildkit-介绍"><a href="#Buildkit-介绍" class="headerlink" title="Buildkit 介绍"></a>Buildkit 介绍</h1><p>最后来说说本文的主角：<a href="https://github.com/moby/buildkit" target="_blank" rel="noopener">buildkit</a></p>
<p>Buildkit 是由 Docker 公司开发的<strong>“下一代 docker build 工具”</strong>，2018 年 7 月正式内置于 Docker-ce 18.06.0 的 Docker daemon ，Mac 和 Linux 可以使用环境变量 <code>DOCKER_BUILDKIT=1</code> 开启，同年 10 月发布社区版本。 </p>
<p>相比于 Docker daemon build，buildkit：</p>
<ul>
<li>更<strong>高效</strong>：支持并行的多阶段构建、更好的缓存管理；</li>
<li>更<strong>安全：</strong>支持 secret mount，无需 root priviliege；</li>
<li>更<strong>易于扩展</strong>：使用自定义中间语言 LLB，完全兼容 Dockerfile，也可支持第三方语言（目前仅有<a href="https://github.com/tonistiigi/buildkit-pack" target="_blank" rel="noopener">Buildpacks</a>），后台目前可支持 runC 和 containerd 两种 worker。</li>
</ul>
<p>目前社区除了 moby/docker-ce 外还在使用 buildkit 的项目有 genuinetools/img, openFaaS Cloud, containerbuilding/cbi。</p>
<h2 id="与其他构建工具对比"><a href="#与其他构建工具对比" class="headerlink" title="与其他构建工具对比"></a>与其他构建工具对比</h2><p><img src="/images/compare-ioc-build.png" alt=""></p>
<p>需要补充的一点是 buildkit 是对 Dockerfile 语法完全支持：</p>
<p><img src="/images/buildkit-full-compatible-dockerfile.png" alt=""></p>
<center>图片来源：<a href="https://www.youtube.com/watch?v=kkpQ_UZn2uo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=kkpQ_UZn2uo</a></center>

<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p><strong>buildkitd &amp; buildctl</strong></p>
<p>后台启动一个buildkitd 守护进程，通过 http 通信的方式执行构建。</p>
<ul>
<li><strong>gRPC API: </strong> 使用 Google RPC 协议高效通信</li>
<li><strong>Go client library：</strong> 基于 Go 的客户端方便调用</li>
<li><strong>rootless execution:</strong>  buildctl 不需要 root 权限就可以执行</li>
<li><strong>OpenTracing：</strong> 支持镜像 layer 的逐层溯源</li>
<li><strong>multi-worker model：</strong>支持多种 worker(runC 和 containerd)，可扩展</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>官方镜像：<a href="https://hub.docker.com/r/moby/buildkit" target="_blank" rel="noopener">https://hub.docker.com/r/moby/buildkit</a></p>
<pre><code class="bash">docker run --name buildkit -d --privileged -p 1234:1234 moby/buildkit --addr tcp://0.0.0.0:1234
export BUILDKIT_HOST=tcp://0.0.0.0:1234
docker cp buildkit:/usr/bin/buildctl /usr/local/bin/
buildctl build --help
</code></pre>
<p>Mac OS 在 <a href="https://github.com/moby/buildkit/releases" target="_blank" rel="noopener">https://github.com/moby/buildkit/releases</a> 下载 buildctl</p>
<h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><pre><code class="bash"># 本地构建
buildctl --addr tcp://localhost:1234 build --frontend=dockerfile.v0 --local context=. --local dockerfile=.
# 等同于 docker build
buildctl --addr tcp://localhost:1234 build --frontend=dockerfile.v0 --local context=. --local dockerfile=. --output type=docker,name=myimage | docker load
# push
buildctl build --frontend dockerfile.v0 --local context=. --local dockerfile=. --output type=image,name=docker.io/username/image,push=true
</code></pre>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><p>使用 docker credentials权限</p>
<p>可以使用环境变量 DOCKER_CONFIG 指定 credential 读取路径从而达到权限隔离（这方面缺少文档，可以参考源码）：</p>
<p><a href="https://github.com/moby/buildkit/blob/master/cmd/buildctl/build.go#L157" target="_blank" rel="noopener">https://github.com/moby/buildkit/blob/master/cmd/buildctl/build.go#L157</a></p>
<p><a href="https://github.com/docker/cli/blob/master/cli/config/config.go#L127" target="_blank" rel="noopener">https://github.com/docker/cli/blob/master/cli/config/config.go#L127</a></p>
<p><img src="/images/docker-config-credential.jpg" alt=""></p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>buildkit 支持 layer 级别缓存，可指定缓存 export/import 路径。</p>
<p>可以使用 registry 缓存：<a href="https://github.com/moby/buildkit#exportingimporting-build-cache-not-image-itself" target="_blank" rel="noopener">https://github.com/moby/buildkit#exportingimporting-build-cache-not-image-itself</a></p>
<h1 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h1><h2 id="运行权限"><a href="#运行权限" class="headerlink" title="运行权限"></a>运行权限</h2><p>Buildkitd 运行需要 privilege，这里有一个 <a href="https://github.com/moby/buildkit/issues/252" target="_blank" rel="noopener">issue</a> 解释说是因为 runC 读写宿主机文件系统需要 root 权限</p>
<h2 id="稳定性测试"><a href="#稳定性测试" class="headerlink" title="稳定性测试"></a>稳定性测试</h2><p>跑了一个晚上的定时脚本，构建的是同一个多阶段镜像，得到的结果不尽如人意：</p>
<ul>
<li><p>速度不太稳定，同一个镜像在没有网络依赖的情况下构建速度在 30s-10min 之间摆动</p>
<p><img src="/images/buildkit-time.png" alt=""></p>
</li>
<li><p>buildctl 和同一台宿主机上的 buildkitd 通信不时会出现网络问题，出现概率 10%</p>
<p><img src="/images/buildkit-error.png" alt=""></p>
</li>
</ul>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>Buildkit 似乎是一个很有前景的产品，只是目前还没有达到生产环境需要的水平。</p>
<p>我比较看好它的设计，比如内置文件数据库，中心化调度思维，前后端可扩展，权限扩展单元，这些都是云原生时代需要的，只是产品的打磨还需要加以时日，以及市场的砺炼。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://s3.amazonaws.com/duyidong-archive/pdf/containerdbuildkitbreakout-180628204303.pdf" target="_blank" rel="noopener">https://s3.amazonaws.com/duyidong-archive/pdf/containerdbuildkitbreakout-180628204303.pdf</a></p>
<p><a href="https://s3.amazonaws.com/duyidong-archive/pdf/Comparing-next-generation-container-image-building-tools.pdf" target="_blank" rel="noopener">https://s3.amazonaws.com/duyidong-archive/pdf/Comparing-next-generation-container-image-building-tools.pdf</a></p>
</div><div class="tags"><a href="/tags/工具/">工具</a><a href="/tags/容器/">容器</a><a href="/tags/docker/">docker</a></div><div class="post-share"></div><div class="post-nav"><a href="/2019/07/01/spider-man-with-the-society/" class="pre">蜘蛛侠电影和这个越来越轻的社会</a><a href="/2019/04/28/springboot-annotation/" class="next">Spring boot 注解</a></div><div id="comments"><div id="disqus_thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#开源工具已经不能满足-DID-的需求"><span class="toc-text">开源工具已经不能满足 DID 的需求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DID-Docker-in-docker-的演进"><span class="toc-text">DID (Docker in docker 的演进)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build-without-docker-daemon"><span class="toc-text">Build without docker daemon</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#社区活跃度"><span class="toc-text">社区活跃度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kaniko-踩坑"><span class="toc-text">kaniko 踩坑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#img-踩坑"><span class="toc-text">img 踩坑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Buildkit-介绍"><span class="toc-text">Buildkit 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#与其他构建工具对比"><span class="toc-text">与其他构建工具对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工作原理"><span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建"><span class="toc-text">构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#权限"><span class="toc-text">权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存"><span class="toc-text">缓存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#不足"><span class="toc-text">不足</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#运行权限"><span class="toc-text">运行权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#稳定性测试"><span class="toc-text">稳定性测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#结论"><span class="toc-text">结论</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/21/spring-boot-log-trace/">Spring boot 全局参数传递和追踪</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/11/bash-study-2/">Bash 学习小计（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/02/one-three-five-years-in-alibaba/">一三五年陈和阿里味</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/18/add-custom-header-via-spring-filter/">在 Filter 中给 HttpServletRequest 添加 Header</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/01/spider-man-with-the-society/">蜘蛛侠电影和这个越来越轻的社会</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/19/build-image-in-container-via-buildkit/">下一代镜像构建工具 Buildkit</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/28/springboot-annotation/">Spring boot 注解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/09/end-of-2018-start-of-2019/">新年伊始</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/aws-certification-share/">AWS 认证分享</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/from-thoughtworks-to-alibaba/">从 ThoughtWorks 到阿里巴巴</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Amazon-Web-Services/">Amazon Web Services</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cloud-PaaS/">Cloud & PaaS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ThoughtWorks/">ThoughtWorks</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习总结/">学习总结</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/我的博客/">我的博客</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/阿里巴巴/">阿里巴巴</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/平台即服务/" style="font-size: 15px;">平台即服务</a> <a href="/tags/DDD/" style="font-size: 15px;">DDD</a> <a href="/tags/代码/" style="font-size: 15px;">代码</a> <a href="/tags/ThoughtWorks/" style="font-size: 15px;">ThoughtWorks</a> <a href="/tags/面试/" style="font-size: 15px;">面试</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/小计/" style="font-size: 15px;">小计</a> <a href="/tags/小结/" style="font-size: 15px;">小结</a> <a href="/tags/大事记/" style="font-size: 15px;">大事记</a> <a href="/tags/AWS/" style="font-size: 15px;">AWS</a> <a href="/tags/Serverless/" style="font-size: 15px;">Serverless</a> <a href="/tags/无服务器架构/" style="font-size: 15px;">无服务器架构</a> <a href="/tags/Lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/云计算/" style="font-size: 15px;">云计算</a> <a href="/tags/亚马逊认证与权限/" style="font-size: 15px;">亚马逊认证与权限</a> <a href="/tags/Security/" style="font-size: 15px;">Security</a> <a href="/tags/IAM/" style="font-size: 15px;">IAM</a> <a href="/tags/S3/" style="font-size: 15px;">S3</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/对象存储服务/" style="font-size: 15px;">对象存储服务</a> <a href="/tags/EC2/" style="font-size: 15px;">EC2</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/CDN/" style="font-size: 15px;">CDN</a> <a href="/tags/Cloudfront/" style="font-size: 15px;">Cloudfront</a> <a href="/tags/Route53/" style="font-size: 15px;">Route53</a> <a href="/tags/博客上云/" style="font-size: 15px;">博客上云</a> <a href="/tags/Cloud-Native/" style="font-size: 15px;">Cloud Native</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/Cloud/" style="font-size: 15px;">Cloud</a> <a href="/tags/云计算认证/" style="font-size: 15px;">云计算认证</a> <a href="/tags/Certification/" style="font-size: 15px;">Certification</a> <a href="/tags/AWS认证考试/" style="font-size: 15px;">AWS认证考试</a> <a href="/tags/Infrastructure-as-Code/" style="font-size: 15px;">Infrastructure as Code</a> <a href="/tags/ThoughtWorks技术雷达/" style="font-size: 15px;">ThoughtWorks技术雷达</a> <a href="/tags/基础设施即代码/" style="font-size: 15px;">基础设施即代码</a> <a href="/tags/持续交付/" style="font-size: 15px;">持续交付</a> <a href="/tags/职场/" style="font-size: 15px;">职场</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/文档规范/" style="font-size: 15px;">文档规范</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/PaaS/" style="font-size: 15px;">PaaS</a> <a href="/tags/Openshift/" style="font-size: 15px;">Openshift</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Platform/" style="font-size: 15px;">Platform</a> <a href="/tags/工作/" style="font-size: 15px;">工作</a> <a href="/tags/理论框架/" style="font-size: 15px;">理论框架</a> <a href="/tags/reveal-js/" style="font-size: 15px;">reveal js</a> <a href="/tags/在线幻灯片/" style="font-size: 15px;">在线幻灯片</a> <a href="/tags/敏捷/" style="font-size: 15px;">敏捷</a> <a href="/tags/DevOps文化/" style="font-size: 15px;">DevOps文化</a> <a href="/tags/CALMS/" style="font-size: 15px;">CALMS</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/coding/" style="font-size: 15px;">coding</a> <a href="/tags/持续集成/" style="font-size: 15px;">持续集成</a> <a href="/tags/主干开发/" style="font-size: 15px;">主干开发</a> <a href="/tags/TBD/" style="font-size: 15px;">TBD</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/其他/" style="font-size: 15px;">其他</a> <a href="/tags/云服务/" style="font-size: 15px;">云服务</a> <a href="/tags/代理/" style="font-size: 15px;">代理</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Class/" style="font-size: 15px;">Class</a> <a href="/tags/面向对象/" style="font-size: 15px;">面向对象</a> <a href="/tags/Shadowsocks/" style="font-size: 15px;">Shadowsocks</a> <a href="/tags/Pipeline/" style="font-size: 15px;">Pipeline</a> <a href="/tags/英文/" style="font-size: 15px;">英文</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/闲言碎语/" style="font-size: 15px;">闲言碎语</a> <a href="/tags/阿里巴巴/" style="font-size: 15px;">阿里巴巴</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Springboot/" style="font-size: 15px;">Springboot</a> <a href="/tags/容器/" style="font-size: 15px;">容器</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Servelet/" style="font-size: 15px;">Servelet</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/DMC/" style="font-size: 15px;">DMC</a> <a href="/tags/全链路追踪/" style="font-size: 15px;">全链路追踪</a> <a href="/tags/Ansible/" style="font-size: 15px;">Ansible</a> <a href="/tags/自动化运维/" style="font-size: 15px;">自动化运维</a> <a href="/tags/Agile/" style="font-size: 15px;">Agile</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/DataBase/" style="font-size: 15px;">DataBase</a> <a href="/tags/TDD/" style="font-size: 15px;">TDD</a> <a href="/tags/版本管理/" style="font-size: 15px;">版本管理</a> <a href="/tags/凤凰式服务/" style="font-size: 15px;">凤凰式服务</a> <a href="/tags/雪花服务器/" style="font-size: 15px;">雪花服务器</a> <a href="/tags/CICD/" style="font-size: 15px;">CICD</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://blog.waterstrong.me/" title="Waterstrong" target="_blank">Waterstrong</a><ul></ul><a href="http://www.huangbowen.net" title="黄博文：我是一个程序员" target="_blank">黄博文：我是一个程序员</a><ul></ul><a href="http://www.april1985.com/" title="he.sicong" target="_blank">he.sicong</a><ul></ul><a href="https://blog.jimmylv.info/" title="吕立青的博客" target="_blank">吕立青的博客</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">杜屹东.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-80279850-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2bba36c0e13cdda70e309bd24cbb844";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.0"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.0" async></script><script>var disqus_shortname = 'www-duyidong-com';
var disqus_identifier = '2019/05/19/build-image-in-container-via-buildkit/';
var disqus_title = '下一代镜像构建工具 Buildkit';
var disqus_url = 'https://www.duyidong.com/2019/05/19/build-image-in-container-via-buildkit/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//www-duyidong-com.disqus.com/count.js" async></script><script type="text/javascript" src="//www-duyidong-com.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></body></html>