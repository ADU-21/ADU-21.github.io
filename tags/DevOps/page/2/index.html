<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/styles.css"><title>标签：DevOps | 杜屹东的博客</title></head><body><div class="container"><div class="columns page-header"><h1>杜屹东的博客</h1></div><div class="columns"><div class="navigation"><nav class="menus-main"><a href="/" class="favicon"><img alt="杜屹东的博客" src="/favicon.png"></a><a href="/about">关于我</a><a href="/list">日志列表</a><a href="/booklist">读书</a><a href="/links">链接</a><a href="/resume">简历</a></nav><nav class="right menus-right"><a target="_blank" href="https://github.com/ADU-21/blog">Fork on Github</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><div class="article-widget"><a href="https://www.duyidong.com/awsSolutionsArchitect_AE.pdf">AWS认证方案解决架构师证书</a></div><div class="article-widget"><strong>标签 #DevOps</strong></div><article><header><h2><a href="/2016/06/15/Ansible学习小记/">Ansible学习小记</a></h2></header><div class="article-meta clearfix"><time class="left">2016 6 月 15 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tags/工具/">工具</a></li><li><a href="/tags/基础设施即代码/">基础设施即代码</a></li><li><a href="/tags/DevOps/">DevOps</a></li><li><a href="/tags/Ansible/">Ansible</a></li><li><a href="/tags/自动化运维/">自动化运维</a></li></ul></div><div class="markdown-body"><h1 id="Ansible是什么"><a href="#Ansible是什么" class="headerlink" title="Ansible是什么"></a>Ansible是什么</h1><p>借助官网上的一句话，ansible is a simple IT automation, 即ansible 是用于IT自动化管理的一个工具<br><a id="more"></a></p>
<h2 id="诞生背景"><a href="#诞生背景" class="headerlink" title="诞生背景"></a>诞生背景</h2><p>在传统小规模开发中，我们在开发机上开发，在Linux服务器上部署，整个过程只需要一个人操作，运维既是在开发机上开发，测试，然后选个凌晨两三点的时间把打包好的字节码文件复制到服务器上，这种开发生产环境用不着自动化配置管理工具。<br>但当我们的开发升级到数十个人的团队，服务器多达数台，这种操作方式的弊端就会显露出来，一是多人协作带来的开发环境和生产环境不一致导致开发环境可用的代码到了生产环境（服务器）上变得不可用，二是多台服务器的重复配置带来的工作内容的冗余，一定程度上降低了我们的生产效率。这种时候运维的角色开始逐渐显现出来。<br>这种级别的运维，通常只需要一些python或者bash脚本就可以实现自动化部署，配置服务器等功能。再加上规范的文档，基本可以解决团队之间的沟通问题。<br>但是随着产品迭代周期的加长，团队的扩大，问题也随之而来，实践中脚本的不易维护，程序员们不愿意更新文档等问题逐渐暴露出来。于是市面上诞生了一批以”代码即文档”为核心思想的自动化配置管理工具，Ansible就是其中之一。</p>
<h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h2><p>ansible主要由几个部分租成，其核心是inventory文件和yaml编写的playbook，按照<a href="http://docs.ansible.com/ansible/playbooks_best_practices.html" target="_blank" rel="external">最佳实践</a>的标准，一个完整的ansible文件应该具有以下结构：</p>
<pre><code>production                # inventory file for production servers
staging                   # inventory file for staging environment

group_vars/
   group1                 # here we assign variables to particular groups
   group2                 # &quot;&quot;
host_vars/
   hostname1              # if systems need specific variables, put them here
   hostname2              # &quot;&quot;

library/                  # if any custom modules, put them here (optional)
filter_plugins/           # if any custom filter plugins, put them here (optional)

site.yml                  # master playbook
webservers.yml            # playbook for webserver tier
dbservers.yml             # playbook for dbserver tier

roles/
    common/               # this hierarchy represents a &quot;role&quot;
        tasks/            #
            main.yml      #  &lt;-- tasks file can include smaller files if warranted
        handlers/         #
            main.yml      #  &lt;-- handlers file
        templates/        #  &lt;-- files for use with the template resource
            ntp.conf.j2   #  &lt;------- templates end in .j2
        files/            #
            bar.txt       #  &lt;-- files for use with the copy resource
            foo.sh        #  &lt;-- script files for use with the script resource
        vars/             #
            main.yml      #  &lt;-- variables associated with this role
        defaults/         #
            main.yml      #  &lt;-- default lower priority variables for this role
        meta/             #
            main.yml      #  &lt;-- role dependencies

    webtier/              # same kind of structure as &quot;common&quot; was above, done for the webtier role
    monitoring/           # &quot;&quot;
    fooapp/               # &quot;&quot;
</code></pre><p>这里我挑几个重点讲：<br>site.yml是ensile playbook的入口文件，执行该文件会依次找到inventory文件，找到hosts组，然后ssh到目标机器组的host上，开始执行task。<br>task是通过调用ansible模块的方式，在远程设备上执行命令来实现配置的，所以理论上可以通过命令行操作的操作，ansible都可以执行。<br>以下为一个task:</p>
<pre><code>-name: install npm
 sudo: yes
 yum:
     name: npm
     state: present
</code></pre><p>该task使用了ansible的yum模块，用于检测远端设备上是否部署了nam，如果没有部署，ansible会进行yum install nam 操作进行安装，安装成功，显示ok，失败则抛出异常并中断ansible执行。</p>
<h2 id="几款自动化配置工具"><a href="#几款自动化配置工具" class="headerlink" title="几款自动化配置工具"></a>几款自动化配置工具</h2><p>我没有使用过其他自动化配置管理工具，在此仅对ansible做进一步介绍<br>ensile的底层实现使用python，在Linux上支持较好，windows支持较弱，因为生产环境和测试环境通常都是Linux操作系统，所以这点无伤大雅。<br>你可以理解成Ansible就是对一批python脚本的封装,你只需要更改一些yams文件就可以达到控制服务器配置版本信息的目的，关于yams语法：<a href="http://www.ansible.com.cn/docs/YAMLSyntax.html" target="_blank" rel="external">http://www.ansible.com.cn/docs/YAMLSyntax.html</a></p>
<h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><h2 id="Ansible的不足之处"><a href="#Ansible的不足之处" class="headerlink" title="Ansible的不足之处"></a>Ansible的不足之处</h2><p>ansible作为一种自动化管理工具实践，形成了一种标准 ，这种标准在实践的过程中难免会有一些不足，比如说既定的命令行和Ansible模块之间的使用存在着一定差距，需要使用的命令行不一定在Ansible中能够找到对应的模块。另外Ansible对于变量的管理也令人诟病，大量的Ansible-playbook如果不按照最佳实践管理变量，或者大量使用冗余变量，会导致文件层级增多，非常难以阅读。。所以在一开始编写Ansible的时候推荐参照最佳实践。但同时我觉得最佳实践文件分德有点太细了，比如说task和vars分开的方式并不能适应很多场景。。好吧但总的来说，Ansible仍是目前管理Linux平台的一个不错的工具。</p>
<h2 id="work-with-ansible"><a href="#work-with-ansible" class="headerlink" title="work with ansible"></a>work with ansible</h2><p>这是我写的一个Ansible文件用来create 一个instance 然后在instance上自动化部署我的博客：</p>
<p><a href="https://github.com/ADU-21/create_hexo_in_ec2_with_ansible" target="_blank" rel="external">https://github.com/ADU-21/create_hexo_in_ec2_with_ansible</a></p>
<p>下面我来教大家一起写一个自己的ansible-playbook<br>首先创建一个host.ini文件:</p>
<pre><code>[host]
localhost
</code></pre><p>这个文件用于指定配置的机器<br>接下来是ansible.cfg，用于指定ansible-pylbook的参数<br>这里包含了inventory和登录到远程设备需要的private key以及remote user:</p>
<pre><code>[defaults]
inventory = host.ini
private_key_file = ~/.ssh/devenv-key.pem
remote_user = ec2-user
</code></pre><p>最后是site.yml，也就是我们的playbook，<br>其工作原理大致是ssh到指定机器上然后执行ansible模块对应的python脚本从而进行社别的配置。</p>
<pre><code>- hosts: local
  connection: local
  gather_facts: False
  roles:
    # - create_instance
    - create_instance_with_cloudformation

- hosts: test
  roles:
      - config_instance
      - test_hexo
</code></pre><p>这和playbook执行的role包含以下含义：从本地连接到local这个组里面的设备，然后执行创建instance 和配置instance 最后测试hexo的工作。<br>接下来在role中是更多的yams使用ansible的模块来达到配置设备的目的。。我就不一一解释了，关于yaml语法可参照文档：</p>
<p><a href="http://docs.ansible.com/ansible/YAMLSyntax.html" target="_blank" rel="external">http://docs.ansible.com/ansible/YAMLSyntax.html</a></p>
<p>关于ansible的模块可参照文档：</p>
<p><a href="http://docs.ansible.com/ansible/index.html" target="_blank" rel="external">http://docs.ansible.com/ansible/index.html</a></p>
</div></article><article><header><h2><a href="/2016/05/19/CI-CD/">CI/CD</a></h2></header><div class="article-meta clearfix"><time class="left">2016 5 月 19 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tags/DevOps/">DevOps</a></li><li><a href="/tags/Agile/">Agile</a></li></ul></div><div class="markdown-body"><h1 id="Agile-Development"><a href="#Agile-Development" class="headerlink" title="Agile Development"></a>Agile Development</h1><p>Before we talk about CI and CD， I think we should figure out why we need them, so we have to talk about Agile Development first.<br>Agile Development is a set of principles for software development. It was develop to response to changing customer’s requirement. As we all know, managers generally desirable to quantify the progress of the development, but quantify of the coding is not easy, the quantify we can only control is the process of the requirment. So we can process a requirement implemented as an iteration cycle of software development.<br>For this purpose, they created with CI and CD as the core of agile development.<br><a id="more"></a></p>
<h2 id="Continuous-Integration-CI"><a href="#Continuous-Integration-CI" class="headerlink" title="Continuous Integration(CI)"></a>Continuous Integration(CI)</h2><p>Continuous Integration means you need to integration at least daily, It’s a development practice that requires developers to integrate code into a shared repository several times a day.”Shared”” means everyone can see what others working on, Frequently compile, test, commit means every times we commit, the code could be running, ideally, every integration should be automated, the unit-test allowing teams to detect problems early. By integration regularly, you can detect errors quickly, and locate them more easily.<br>there are many advantages for Continuous Integration, one of which is the continuous delivery.</p>
<h2 id="Continuous-Delivery-CD"><a href="#Continuous-Delivery-CD" class="headerlink" title="Continuous Delivery(CD)"></a>Continuous Delivery(CD)</h2><p>Continuous Delivery is customer requirement oriented, It’s like Continuous Integration but more than it, Continuous Delivery is the natural extension of Continuous Integration, Continuous Delivery makes releases boring, so we can deliver frequently and get fast feedback on what users care about.</p>
<h2 id="Continuous-Deployment"><a href="#Continuous-Deployment" class="headerlink" title="Continuous Deployment"></a>Continuous Deployment</h2><p>Continuous Deployment is more than Continuous Delivery, seams like this:<br> <img src="https://d1089v03p3mzyq.cloudfront.net/assets/website/continuous-integration-essentials/continuous-delivery-vs-continuous-deployment-b371cf5be55b1c52635058af7b70188cd2b608bfb92ca5487a3e41694e9ccf6b.jpg" alt="88cd2b608bfb92ca5487a3e41694e9ccf6b.jpg"><br>It is the practice of keeping your codebase deployable at any point. Beyond making sure your application passes automated tests it has to have all the configuration necessary to push it into production. Many teams then do push changes that pass the automated tests into a test or production environment immediately to ensure a fast development loop.<br>A simplified continuous deployment flow can look like this:<br><img src="https://risingstack-blog.s3-eu-west-1.amazonaws.com/2014/Sep/Continuous-deployment---New-Page.png" alt="New-Page.png"></p>
<h2 id="Development-Operations-DevOps"><a href="#Development-Operations-DevOps" class="headerlink" title="Development Operations(DevOps)"></a>Development Operations(DevOps)</h2><p>Development Operations is bigger than Continuous Deployment, It aims at establishing a culture and environment where building testing, and releasing software, can happen rapidly, and more reliably.<br>In my words, DevOps is a practical form of agile.</p>
<h2 id="Tools-for-CI-and-CD"><a href="#Tools-for-CI-and-CD" class="headerlink" title="Tools for CI and CD"></a>Tools for CI and CD</h2><p><a href="https://jenkins.io/" target="_blank" rel="external">Jenkins</a></p>
<p><a href="https://www.go.cd/download/" target="_blank" rel="external">GoCD</a></p>
<p><a href="https://www.jetbrains.com/teamcity/" target="_blank" rel="external">TeamCity</a></p>
<p><a href="https://travis-ci.org/" target="_blank" rel="external">Travis CI</a></p>
</div></article><div class="archive-pagination"><div class="paginator"><a class="extend prev" rel="prev" href="/tags/DevOps/">&laquo;</a><a class="page-number" href="/tags/DevOps/">1</a><span class="page-number current">2</span></div></div></div><div class="block-sidebar column one-fourth"><div class="widget text-content"><p>杜屹东 生于 1993.12.16, 英文 ID Luke Du</p>
<ul>
<li>现就职于<a href="https://www.thoughtworks.com/">ThoughtWorks</a></li>
<li>毕业于 <a href="http://www.xhu.edu.cn/">西华大学</a> 计算机科学与技术</li>
<li>AWS认证方案解决架构师</li>
<li>喜欢<a href="http://baike.baidu.com/view/39292.htm">史铁生</a>, <a href="https://movie.douban.com/celebrity/1012521/">David Fincher</a> 和 <a href="http://baike.baidu.com/view/2556.htm">陈奕迅</a></li>
<li>在剧组和影视公司工作过，曾参与成龙大哥电影<a href="https://movie.douban.com/subject/24529353/">《绝地逃亡》</a>制作</li>
<li>曾骑行成都-拉萨，成都-北京，海南环岛</li>
</ul>
<p>目前专注于：</p>
<ul>
<li>Cloud Native - 云解决方案</li>
<li>Serverless - 无服务器架构</li>
<li>Fintech - 金融科技</li>
<li>DevOps - 文化组织变革</li>
<li>CI/CD - 持续集成与持续交付</li>
</ul>
</div><div class="widget tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS认证考试/">AWS认证考试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Agile/">Agile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDN/">CDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Certification/">Certification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud-Native/">Cloud Native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloudfront/">Cloudfront</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DataBase/">DataBase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EC2/">EC2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IAM/">IAM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Infrastructure-as-Code/">Infrastructure as Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Route53/">Route53</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/S3/">S3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Serverless/">Serverless</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Study/">Study</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TDD/">TDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThoughtWorks/">ThoughtWorks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThoughtWorks技术雷达/">ThoughtWorks技术雷达</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/上云/">上云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/云计算/">云计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/云计算认证/">云计算认证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/云计算资源/">云计算资源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/亚马逊认证与权限/">亚马逊认证与权限</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码/">代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/凤凰式服务/">凤凰式服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客上云/">博客上云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/基础设施即代码/">基础设施即代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大事记/">大事记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习/">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/对象存储服务/">对象存储服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小结/">小结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小计/">小计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/持续交付/">持续交付</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/持续部署/">持续部署</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/无服务器架构/">无服务器架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/版本管理/">版本管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/职场/">职场</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化运维/">自动化运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/部署与发布/">部署与发布</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/雪花服务器/">雪花服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul></div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">5</span></li></ul></div><div class="widget text-content"><p>该博客使用基于 &nbsp;<a href="http://hexo.io">Hexo</a>&nbsp; 的 &nbsp;<a href="https://github.com/jysperm/hexo-theme-simpleblock">simpleblock</a>&nbsp; 主题。博客内容使用 &nbsp;<a href="https://aws.amazon.com/s3/">Amazon S3</a>&nbsp; 发布。最后生成于 2017-04-15.</p></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-80279850-1', 'auto');
ga('send', 'pageview');
</script><script>window.duoshuoQuery = {short_name: 'duuyidong'}</script><script src="https://static.duoshuo.com/embed.js"></script></body></html>